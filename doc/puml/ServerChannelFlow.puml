@startuml
'https://plantuml.com/object-diagram

!theme cyborg-outline
skinparam backgroundColor #000

title "Channel and Flow usage"

together {
    Object Input <<Channel>> {
        Receives messages\nsend by any client.
    }
    Object FinalFlow <<SharedFlow>> {
        Contains the last X\npropagated messages.
    }

    object DbBridge {
        Loads the last X messages\nfrom the DB and stores all\nreceived messages in the DB.
    }
    object ChatBot {
        Parses all messages starting with ""/"":
        - ""/color #000000"" -> changes color of user
        - ""/me â€¦"" -> indirect speech
    }

    Input "1" *-> "1" DbBridge
    DbBridge "1" *-> "1" ChatBot
    ChatBot "1" *-> "1" FinalFlow
}

together {
    rectangle KTOR {
        Object WebServiceInput <<ReceiveChannel>> {
            Provides all messages send\nby the connected client.
        }
        Object WebServiceOutput <<SendChannel>> {
            Messages send to this ""Channel"" will\nbe forwarded to the connected client.
        }
    }
    WebServiceInput "0..*\t" *--> "1" Input
    FinalFlow "1\t" *--> "0..*" WebServiceOutput
}

@enduml
